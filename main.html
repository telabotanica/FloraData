<!DOCTYPE html>
<html>
	<head> 
		<title>Carnet en ligne</title> 
		
		<meta http-equiv="content-type" content="text/html; charset=UTF-8"/>
		<meta http-equiv="content-style-type" content="text/css" />
		<meta http-equiv="content-script-type" content="text/javascript" />
		<meta http-equiv="content-language" content="fr" />
		<meta http-equiv="cache-control" content="no-cache">
		
		<!-- Favicones -->
		<link rel="shortcut icon" type="image/x-icon" href="img/s_favicon.ico" />
		
		<!-- Viewport -->
		<meta name="apple-mobile-web-app-capable" content="yes" />
		<meta name="apple-mobile-web-app-status-bar-style" content="black" />
		<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no"> 
		
		
		<!-- CSS -->
		<link href="css/normalize.css" rel="stylesheet" type="text/css" />
		<link href="css/bootstrap.mobile.css" rel="stylesheet" type="text/css"/>
			
		
		<!-- my CSS -->
		<link href="less/bootstrap.less" rel="stylesheet/less" type="text/css" />
		<link href="less/ailante-bs.less" rel="stylesheet/less" type="text/css" />
		
		
		<!-- Javascript -->
		<script type="text/javascript" src="http://www.tela-botanica.org/commun/jquery/1.7.1/jquery-1.7.1.min.js"></script>		
		<script type="text/javascript" src="phonegap.js"></script>		
		<script type="text/javascript" src="js/optionsMenu.js"></script>
		
		
		<!-- Jquery UI : nécessaire pour l'auto-complétion -->
		<script type="text/javascript" src="http://www.tela-botanica.org/commun/jquery/jquery-ui/1.8.18/js/jquery-ui-1.8.18.custom.min.js"></script>
		
		<!-- Javascript : appli saisie -->
		<script type="text/javascript">
		//<![CDATA[
			// La présence du parametre 'debug' dans l'URL enclenche le dégogage
			var DEBUG = false;
			// La présence du parametre 'html5' dans l'URL enclenche les fonctions avancées HTML5
			var HTML5 = false;
			// Mot-clé du widget/projet
			var TAG_PROJET = "WidgetSaisie";
			// Mots-clés à ajouter aux images
			var TAG_IMG = "";
			TAG_IMG = TAG_IMG;
			// Mots-clés à ajouter aux observations
			var TAG_OBS = "";
			TAG_OBS = TAG_OBS;
			// URL du web service réalisant l'insertion des données dans la base du CEL.
			var SERVICE_SAISIE_URL = "http://www.tela-botanica.org/eflore/cel/jrest/CelWidgetSaisie";
			// Code du référentiel utilisé pour les nom scientifiques (de la forme nom:code).
			var NOM_SCI_REFERENTIEL = "bdtfx:1.01";
			// Nom du référentiel utilisé pour les nom scientifiques.
			var NOM_SCI_PROJET = "bdtfx";
			// Code de la version du référentiel utilisé pour les nom scientifiques.
			var NOM_SCI_VERSION = "1.01";
			// Indication de la présence d'une espèce imposée
			var ESPECE_IMPOSEE = "";
			// Tableau d'informations sur l'espèce imposée
			var INFOS_ESPECE_IMPOSEE = Array;
			// Nombre d'élément dans les listes d'auto-complétion
			var AUTOCOMPLETION_ELEMENTS_NBRE = 20;
			// Indication de la présence d'un référentiel imposé
			var REFERENTIEL_IMPOSE = "";
			// Indication des version utilisées de chaque référentiel
			var PROJETS_VERSIONS = {"bdtfx":"1.01","bdtxa":"1.00"};
			// URL du web service permettant l'auto-complétion des noms scientifiques.
			var SERVICE_AUTOCOMPLETION_NOM_SCI_URL = "http://www.tela-botanica.org/service:eflore:0.1/bdtfx/noms?"+
					"masque={masque}&"+
					"recherche=etendue&"+
					"retour.champs=famille,nom_retenu,nom_retenu_complet,num_taxonomique,nom_retenu.id&"+
					//"version.projet="+NOM_SCI_VERSION+"&"+
					"ns.structure=au"+"&"+
					"navigation.limite="+AUTOCOMPLETION_ELEMENTS_NBRE;
			// URL du web service permettant l'auto-complétion des noms scientifiques.
			var SERVICE_AUTOCOMPLETION_NOM_SCI_URL_TPL = "http://www.tela-botanica.org/service:eflore:0.1/{referentiel}/noms?"+
					"masque={masque}&"+
					"recherche=etendue&"+
					"retour.champs=famille,nom_retenu,nom_retenu_complet,num_taxonomique,nom_retenu.id&"+
					//"version.projet="+NOM_SCI_VERSION+"&"+
					"ns.structure=au"+"&"+
					"navigation.limite="+AUTOCOMPLETION_ELEMENTS_NBRE;
			// Nombre d'observations max autorisé avant transmission
			var OBS_MAX_NBRE = 10;
			// Durée d'affichage en milliseconde des messages d'informations
			var DUREE_MESSAGE = 15000;
			// Squelette d'URL du web service d'eFlore fournissant les noms de communes.
			var SERVICE_NOM_COMMUNE_URL = "http://www.tela-botanica.org/service:eflore:0.1/osm/nom-commune?lon={lon}&lat={lat}";
			// Squelette d'URL du web service d'eFlore fournissant les noms de communes hors de France (localisation approximative).
			var SERVICE_NOM_COMMUNE_URL_ALT = "http://www.tela-botanica.org/service:eflore:0.1/wikipedia/nom-commune?lon={lon}&lat={lat}&nbre=1";
			// URL du marqueur à utiliser dans la carte Google Map
			var GOOGLE_MAP_MARQUEUR_URL = "http://www.tela-botanica.org/widget:cel:modules/saisie/squelettes/defaut/img/marqueurs/epingle.png";
			// URL de l'icône du chargement en cours
			var CHARGEMENT_ICONE_URL = "http://www.tela-botanica.org/widget:cel:modules/saisie/squelettes/defaut/img/icones/chargement.gif";
			// URL de l'icône du chargement en cours d'une image
			var CHARGEMENT_IMAGE_URL = "http://www.tela-botanica.org/widget:cel:modules/saisie/squelettes/defaut/img/icones/chargement-image.gif";
			// URL de l'icône du calendrier
			var CALENDRIER_ICONE_URL = "http://www.tela-botanica.org/widget:cel:modules/saisie/squelettes/defaut/img/icones/calendrier.png";
			// URL de l'icône du calendrier
			var PAS_DE_PHOTO_ICONE_URL = "http://www.tela-botanica.org/widget:cel:modules/saisie/squelettes/defaut/img/icones/pasdephoto.png";
		//]]>
		</script>
		<script type="text/javascript" src="js/defaut.js"></script>
		<script type="text/javascript" src="js/capture.js"></script>
		<script>
			document.addEventListener("deviceready", onDeviceReady, false);
			
			function onDeviceReady() {
			
				var onHelp = function() {
					alert('Application soutenue par Tela-Botanice \n'+
							'Développée par Zedd971');
				}
				
				var onSettings = function() {
					alert(	'Device Name: '     + device.name     + '\n' + 
							'Device PhoneGap: ' + device.phonegap + '\n' + 
							'Device Platform: ' + device.platform + '\n' + 
							'Device UUID: '     + device.uuid     + '\n' + 
							'Device Version: '  + device.version  + '\n' + 
						 );
				}
				
				
			    // process the confirmation dialog result
				function onConfirm(button) {
					alert('You selected button ' + button);
					if (button == 1) {
						exitFromApp();
					}
				}

				// Show a custom confirmation dialog
				//
				var showConfirm = function() {
					navigator.notification.confirm(
						'Voulez-vous vraiment quitter CeL Mobile ?',  // message
						onConfirm,              // callback to invoke with index of button pressed
						'Quitter',            // title
						'Je pars., Non ! Je reste.'          // buttonLabels
					);
				}
				
				
				var checkConnection = function() {
					var networkState = navigator.network.connection.type;

					var states = {};
					states[Connection.UNKNOWN]  = 'Unknown connection';
					states[Connection.ETHERNET] = 'Ethernet connection';
					states[Connection.WIFI]     = 'WiFi connection';
					states[Connection.CELL_2G]  = 'Cell 2G connection';
					states[Connection.CELL_3G]  = 'Cell 3G connection';
					states[Connection.CELL_4G]  = 'Cell 4G connection';
					states[Connection.NONE]     = 'No network connection';

					alert('Connection type: ' + states[networkState]);
				}
				
				
				function onError() {
					alert('onError!');
				};
				
				function onSuccessK(heading) {
					alert('Heading: ' + heading);
				};

				var kompass = function() {
					navigator.compass.getCurrentHeading(onSuccessK, onError);
				}
				
				
				function onSuccessA(acceleration) {
					alert('Acceleration X: ' + acceleration.x + '\n' +
						  'Acceleration Y: ' + acceleration.y + '\n' +
						  'Acceleration Z: ' + acceleration.z + '\n' +
						  'Timestamp: '      + acceleration.timestamp + '\n');
				};
				var vroum_vroum = function() {
					navigator.accelerometer.getCurrentAcceleration(onSuccessA, onError);
				}


				var optionsmenu = new OptionsMenu({
					id: "optionsmenu",
					items: [
						[ 
							{
								label: "Settings",
								image: "img/_logo_sauvages_alpha.png",
								action: onSettings
							},
							{
								label: "Help",
								image: "img/_logo_tela.png",
								action: onHelp
							} 
						],
						[ 
							{
								label: "Accelerometer",
								image: "img/s_info_alpha.png",
								action: vroum_vroum
							} 
						],
						[ 
							{
								label: "Quitter",
								image: "img/mail.png",
								action: showConfirm
							},
							{
								label: "Connexion",
								image: "img/phone.png",
								action: checkConnection
							},
							{
								label: "Direction ?",
								image: "img/sms.png",
								action: kompass
							} 
						],
					],
				});
			}
			
			function exitFromApp() {				
				navigator.notification.beep(2);
				navigator.notification.vibrate(2000);

				navigator.app.exitApp();
			}
		</script>
	</head>
	
	
	<body class="container"> 
		
		<header class="row clearfix margin-bottom-1em white-bg black">
			<a href="index.html">
				<img src="img/_logo_tela_qr.png" class="pull-left span3 logo" />
			</a>

			<div class="pull-left titre span7">
				Ajout observations <br /> Carnet en ligne
			</div>
			
			<div class="margin-top-1em">
				<img src="img/s_info_alpha.png" class="pull-left span1 logo " />
			</div>
		</header>
		
		
		
		<div>
			<form id="form-obs" action="#" autocomplete="on">
				<div class="row">
					<div>
						<label for="referentiel" title="Réferentiel">
							Référentiel
						</label>
						<span class="input-prepend">
							<span id="referentiel-icone" class="add-on"><i class="icon-book"></i></span>
							<select id="referentiel" autocomplete="off">
								<option value="bdtfx" selected="selected" title="Trachéophytes de France métropolitaine">Métropole (BDTFX)</option>
								<option value="bdtxa" title="Trachéophytes des Antilles">Antilles françaises (BDTXA)</option>
							</select>
						</span>
					</div>
				</div>
								
				
				<div id="taxon-input-groupe" class="row" >
					<label for="taxon" title="Choisissez une espèce">
						<strong class="obligatoire">*</strong> 
						Espèce  <em>(ou indication sur la plante)</em>
					</label>
					<div class="input-prepend">
						<span class="add-on">
							<i class="icon-leaf"></i>
						</span>
						<input type="text" id="taxon" name="taxon" value="" />
					</div>
				</div>
				
								
				<div class="row">
					<label for="referentiel" title="Réferentiel">
						Certitude
					</label>
					<span class="input-prepend">
						<span id="referentiel-icone" class="add-on"><i class="icon-book"></i></span>
						<select id="referentiel" autocomplete="off">
							<option value="100" selected="selected" >Certain(e)</option>
							<option value="0" >Hasard</option>
						</select>
					</span>
				</div>
			</form>
			
			
			<ul class="nav nav-tabs" id="myTab">						
				<li class="active"><a href="#precisions-lieu">Précisions lieu</a></li>
				<li><a href="#precisions-plante">Précisions plante</a></li>
				<li><a href="#localisation">Z</a></li>
			</ul>
 
			<div id="precisions-txt">
				<div class="tab-content">
					<div class="tab-pane active" id="precisions-lieu">
						<form id="form-lieu" class="control-group" action="#" enctype="multipart/form-data" autocomplete="on">
							<div rel="tooltip" 
								title="Toponyme plus précis que la commune, utilisé localement et se trouvant souvent sur les cartes au 1/25 000." >
								<label for="lieudit">Lieu-dit</label>
								<div>
									<input type="text" id="lieudit" name="lieudit"/>
								</div>
							</div>
							<div rel="tooltip" 
								title="Lieu précis de l'observation définissant une unité écologique homogène (ex: le pré derrière la maison)." >
								<label for="station">Station</label>
								<div>
									<input type="text" id="station" name="station"/>
								</div>
							</div>
							<div rel="tooltip" 
								title="Type d'habitat plus ou moins standardisé dans les codes Corine ou Catminat (ex: prairie humide).">
								<label for="milieux">Habitat</label>
								<div>
									<input type="text" id="milieu" name="milieu" />
								</div>
							</div>
						</form>	
					</div>
		
		
					<div class="tab-pane" id="precisions-plante">
						<form id="form-plante" class="control-group" action="#" enctype="multipart/form-data" autocomplete="on">
								<div>
									<label for="abondance">Abondance</label>
									<div>
										<input type="text" id="abondance" name="abondance"/>
									</div>
								</div>
								<div>
									<label for="stade_ph">Stade phénologique</label>
									<div>
										<input type="text" id="stade_ph" name="stade_ph"/>
									</div>
								</div>
						</form>	
					</div>
		
		
					<div class="tab-pane" id="localisation">
						<form id="form-gps" class="control-group" action="#" enctype="multipart/form-data" autocomplete="off">											
							<div class="margin-top-1em gris-bg span10">
								<label>
									Localisation de l'appareil
								</label>
								<input type="text" class="btn disabled" id="lat_field" name="latitude" />
								<input type="text" class="btn disabled" id="long_field" name="longitude" />
								<input type="text" class="btn disabled" id="date" name="date" value="" />
							 
								<script>
									navigator.geolocation.getCurrentPosition(
										function(pos) {
											$("#lat_field").val(pos.coords.latitude);
											$("#long_field").val(pos.coords.longitude);
										}, 
										function(error) {
											alert('code: '    + error.code    + '\n' +
												  'message: ' + error.message + '\n');
										},
										{ enableHighAccuracy: true }
									);
									
									
									$('#myTab a').click(function (e) {
										e.preventDefault();
										$(this).tab('show');
									});
									
									
									var d = new Date();
									var month = d.getMonth()+1;
									var day = d.getDate();
									
									$("#date").val(
										((''+day).length<2 ? '0' : '') + day + '/' +
										((''+month).length<2 ? '0' : '') + month + '/' +
										d.getFullYear()
									);
								</script>
							</div>
						</form>	
					</div>
				</div> <!-- #tab-content -->
			</div> <!-- #precisions-txt -->
			
						
			<div class="row">
				<h4>Photo : 
					<button type="button" onclick="capturePhoto();" class="btn btn-large">
						<i class="icon-camera"></i>
					</button>
				</h4>
			</div>

			<img id="myImage" src="" width="50%" style="display:none"/>
			<input type="button" onclick="deletePhoto();" value="Supprimer la photo" />
			
			
			
			<div class="row">
				<div class="span12 align-center">
					<button id="ajouter-obs" class="btn btn-primary btn-large" type="button">
						Ajouter Obs
					</button>
				</div>
			</div>
			
			
			<a onclick="OnLoad();">Test Connexion</a>
			<div id="liste-obs" ></div>
		</div>
		<script type="text/javascript">
			var watchID;
			
			function OnLoad () {
				if ('onLine' in navigator) {
					if (navigator.onLine) {
						alert ("Your browser is working online.");
					}
					else {
						alert ("Your browser is working offline.");
					}
				}
				else {
					alert ("Your browser does not support the onLine property.");
				}
				
				watchID = navigator.geolocation.watchPosition(onSuccess, onError, { enableHighAccuracy: true });
			}
			
			
			function onSuccess(position) {
				var div = document.getElementById('myDiv');
				
				div.innerHTML = 'Watch ID: '             + watchID  + '<br/>' +
								'Latitude: '             + position.coords.latitude  + '<br/>' +
								'Longitude: '            + position.coords.longitude + '<br/>' +
								'Altitude: '             + position.coords.altitude  + '<br/>' +
								'Accuracy: '             + position.coords.accuracy  + '<br/>' +
								'Altitude Accuracy: '    + position.coords.altitudeAccuracy  + '<br/>' +
								'Heading: '              + position.coords.heading   + '<br/>' +
								'Speed: '                + position.coords.speed     + '<br/>';
								
				navigator.geolocation.clearWatch(watchID);
				alert("End Watch");
			}
			
			function onError(error) {
				alert('code : '    + error.code    + '\n' +
					  'message : ' + error.message + '\n');
			}
		</script>
		
		
		<div id="myDiv"></div>		
		
		
		<footer id="footer" class="vert-fonce-bg white">
			<div class="row margin-ud-1em">
				<div class="span2 margin-left-05em">
					<a href="index.html">
						Ajout
					</a>
				</div>
				<div class="span2 margin-right-05em">
					<a href="http://google.com">
						Accueil
					</a>
				</div>
				<div class="span3 margin-right-05em">
					<a href="http://tela-botanica.org">
						Espèces
					</a>
				</div>
				<div class="span3 margin-right-05em">
					<a href="http://france-antilles.fr">
						Mon profil
					</a>
				</div>
			</div>
		</footer>
		
		
		<script type="text/javascript" src="js/less-1.3.3.min.js"></script>
		<script type="text/javascript" src="js/bootstrap.min.js"></script>
	</body>
	
</html>
